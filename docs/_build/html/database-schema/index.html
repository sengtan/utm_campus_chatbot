

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1. Database Schema Reference &mdash; UTM Campus Assistant Admin Manual 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="../configuration-reference/index.html" />
    <link rel="prev" title="&lt;no title&gt;" href="../api-reference/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            UTM Campus Assistant Admin Manual
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">1. Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">2. Configuration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first-setup/index.html">3. First Setup Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Administration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-dashboard/index.html">1. Admin Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-management/index.html">2. User Management</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Maintenance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/index.html">1. Troubleshooting Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Database Schema Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">1.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#entity-relationship-diagram">1.2. Entity Relationship Diagram</a></li>
<li class="toctree-l2"><a class="reference internal" href="#table-schemas">1.3. Table Schemas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#users">1.3.1. users</a></li>
<li class="toctree-l3"><a class="reference internal" href="#facilities">1.3.2. facilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="#issues">1.3.3. issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="#facility-bookings">1.3.4. facility_bookings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#chat-sessions">1.3.5. chat_sessions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#chat-messages">1.3.6. chat_messages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#database-operations">1.4. Database Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#common-queries">1.4.1. Common Queries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#database-maintenance">1.5. Database Maintenance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#regular-maintenance-tasks">1.5.1. Regular Maintenance Tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#backup-and-recovery">1.5.2. Backup and Recovery</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#performance-optimization">1.6. Performance Optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#index-optimization">1.6.1. Index Optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#database-size-management">1.6.2. Database Size Management</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#migration-scripts">1.7. Migration Scripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#schema-updates">1.7.1. Schema Updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-migration">1.7.2. Data Migration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#security-considerations">1.8. Security Considerations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-protection">1.8.1. Data Protection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#access-control">1.8.2. Access Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#backup-security">1.8.3. Backup Security</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/index.html">2. Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">UTM Campus Assistant Admin Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">1. </span>Database Schema Reference</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/database-schema/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="database-schema-reference">
<h1><span class="section-number">1. </span>Database Schema Reference<a class="headerlink" href="#database-schema-reference" title="Link to this heading"></a></h1>
<p>This document describes the complete database schema for the UTM Campus Assistant system.</p>
<section id="overview">
<h2><span class="section-number">1.1. </span>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The system uses SQLite as the default database with the following core tables:</p>
<ul class="simple">
<li><p><strong>users</strong>: User account information</p></li>
<li><p><strong>facilities</strong>: Campus facility data</p></li>
<li><p><strong>issues</strong>: Facility issue reports</p></li>
<li><p><strong>facility_bookings</strong>: Facility booking requests</p></li>
<li><p><strong>chat_sessions</strong>: Chatbot conversation sessions</p></li>
<li><p><strong>chat_messages</strong>: Individual chat messages</p></li>
</ul>
</section>
<section id="entity-relationship-diagram">
<h2><span class="section-number">1.2. </span>Entity Relationship Diagram<a class="headerlink" href="#entity-relationship-diagram" title="Link to this heading"></a></h2>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│    users    │    │ facilities  │    │   issues    │
│─────────────│    │─────────────│    │─────────────│
│ id (PK)     │◄──┐│ id (PK)     │◄──┐│ id (PK)     │
│ username    │   ││ name        │   ││ title       │
│ email       │   ││ category    │   ││ description │
│ password_hash│   ││ location    │   ││ user_id (FK)│
│ role        │   ││ description │   ││facility_id │
│ full_name   │   ││ is_bookable │   │└─────────────┘
│ student_id  │   ││ capacity    │   │
│ created_at  │   │└─────────────┘   │
└─────────────┘   │                  │
        │         │                  │
        │         │ ┌─────────────┐  │
        │         └─┤facility_    │  │
        │           │bookings     │  │
        │           │─────────────│  │
        │           │ id (PK)     │  │
        │           │facility_id  │  │
        │           │ user_id (FK)├──┘
        │           │booking_date │
        │           │ start_hour  │
        │           │ end_hour    │
        │           │ status      │
        │           └─────────────┘
        │
        │ ┌─────────────┐    ┌─────────────┐
        └─┤chat_sessions│◄──┐│chat_messages│
          │─────────────│   ││─────────────│
          │ id (PK)     │   ││ id (PK)     │
          │ user_id (FK)│   ││session_id   │
          │ session_id  │   ││ message     │
          │ created_at  │   ││ is_user     │
          └─────────────┘   ││ intent      │
                            ││ entities    │
                            │└─────────────┘
                            │
                            └──────────────────┘
</pre></div>
</div>
</section>
<section id="table-schemas">
<h2><span class="section-number">1.3. </span>Table Schemas<a class="headerlink" href="#table-schemas" title="Link to this heading"></a></h2>
<section id="users">
<h3><span class="section-number">1.3.1. </span>users<a class="headerlink" href="#users" title="Link to this heading"></a></h3>
<p>Stores user account information for both students and administrators.</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">users Table Schema</span><a class="headerlink" href="#id1" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 15.0%" />
<col style="width: 45.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Constraints</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>INTEGER</p></td>
<td><p>PRIMARY KEY</p></td>
<td><p>Unique user identifier</p></td>
</tr>
<tr class="row-odd"><td><p>username</p></td>
<td><p>VARCHAR(80)</p></td>
<td><p>UNIQUE, NOT NULL</p></td>
<td><p>Login username (4-20 characters)</p></td>
</tr>
<tr class="row-even"><td><p>email</p></td>
<td><p>VARCHAR(120)</p></td>
<td><p>UNIQUE, NOT NULL</p></td>
<td><p>User email address</p></td>
</tr>
<tr class="row-odd"><td><p>password_hash</p></td>
<td><p>VARCHAR(256)</p></td>
<td><p>NOT NULL</p></td>
<td><p>Bcrypt hashed password</p></td>
</tr>
<tr class="row-even"><td><p>role</p></td>
<td><p>ENUM</p></td>
<td><p>NOT NULL, DEFAULT ‘student’</p></td>
<td><p>User role (student/admin)</p></td>
</tr>
<tr class="row-odd"><td><p>full_name</p></td>
<td><p>VARCHAR(100)</p></td>
<td><p>NOT NULL</p></td>
<td><p>Complete user name</p></td>
</tr>
<tr class="row-even"><td><p>student_id</p></td>
<td><p>VARCHAR(20)</p></td>
<td><p>UNIQUE, NULLABLE</p></td>
<td><p>University student ID</p></td>
</tr>
<tr class="row-odd"><td><p>created_at</p></td>
<td><p>DATETIME</p></td>
<td><p>DEFAULT CURRENT_TIMESTAMP</p></td>
<td><p>Account creation time</p></td>
</tr>
</tbody>
</table>
<p><strong>Indexes:</strong>
- Unique index on username
- Unique index on email
- Unique index on student_id (where not null)</p>
<p><strong>Example Record:</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;student001&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;student001@utm.my&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;$2b$12$hash...&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;student&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;Ahmad bin Ali&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;A20EC0001&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;2025-01-15 10:30:00&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
<section id="facilities">
<h3><span class="section-number">1.3.2. </span>facilities<a class="headerlink" href="#facilities" title="Link to this heading"></a></h3>
<p>Contains information about campus facilities available for booking and issue reporting.</p>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">facilities Table Schema</span><a class="headerlink" href="#id2" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 15.0%" />
<col style="width: 45.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Constraints</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>INTEGER</p></td>
<td><p>PRIMARY KEY</p></td>
<td><p>Unique facility identifier</p></td>
</tr>
<tr class="row-odd"><td><p>name</p></td>
<td><p>VARCHAR(100)</p></td>
<td><p>NOT NULL</p></td>
<td><p>Facility name</p></td>
</tr>
<tr class="row-even"><td><p>category</p></td>
<td><p>VARCHAR(50)</p></td>
<td><p>NOT NULL</p></td>
<td><p>Facility category</p></td>
</tr>
<tr class="row-odd"><td><p>location</p></td>
<td><p>VARCHAR(200)</p></td>
<td><p>NOT NULL</p></td>
<td><p>Physical location description</p></td>
</tr>
<tr class="row-even"><td><p>description</p></td>
<td><p>TEXT</p></td>
<td><p>NULLABLE</p></td>
<td><p>Detailed facility description</p></td>
</tr>
<tr class="row-odd"><td><p>is_bookable</p></td>
<td><p>BOOLEAN</p></td>
<td><p>DEFAULT FALSE</p></td>
<td><p>Whether facility can be booked</p></td>
</tr>
<tr class="row-even"><td><p>capacity</p></td>
<td><p>INTEGER</p></td>
<td><p>NULLABLE</p></td>
<td><p>Maximum occupancy</p></td>
</tr>
<tr class="row-odd"><td><p>operating_hours</p></td>
<td><p>VARCHAR(100)</p></td>
<td><p>NULLABLE</p></td>
<td><p>Operating hours description</p></td>
</tr>
<tr class="row-even"><td><p>contact_info</p></td>
<td><p>VARCHAR(200)</p></td>
<td><p>NULLABLE</p></td>
<td><p>Contact information/landmarks</p></td>
</tr>
<tr class="row-odd"><td><p>created_at</p></td>
<td><p>DATETIME</p></td>
<td><p>DEFAULT CURRENT_TIMESTAMP</p></td>
<td><p>Record creation time</p></td>
</tr>
</tbody>
</table>
<p><strong>Indexes:</strong>
- Index on category
- Index on is_bookable
- Index on name</p>
<p><strong>Facility Categories:</strong>
- Laboratory
- Academic
- Sports
- Administrative
- Accommodation
- Dining
- Event</p>
<p><strong>Example Record:</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">facilities</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;Computer Lab 1&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;Laboratory&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;Block A, Level 2, Room A201&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;Main computer lab with 40 workstations equipped with latest software&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="k">TRUE</span><span class="p">,</span>
<span class="w">    </span><span class="mi">40</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;8:00 AM - 6:00 PM (Mon-Fri)&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;Near main entrance, Landmarks: Faculty of Computing building&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;2025-01-10 09:00:00&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
<section id="issues">
<h3><span class="section-number">1.3.3. </span>issues<a class="headerlink" href="#issues" title="Link to this heading"></a></h3>
<p>Tracks facility-related issues reported by users.</p>
<table class="docutils align-default" id="id3">
<caption><span class="caption-text">issues Table Schema</span><a class="headerlink" href="#id3" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 15.0%" />
<col style="width: 45.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Constraints</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>INTEGER</p></td>
<td><p>PRIMARY KEY</p></td>
<td><p>Unique issue identifier</p></td>
</tr>
<tr class="row-odd"><td><p>title</p></td>
<td><p>VARCHAR(200)</p></td>
<td><p>NOT NULL</p></td>
<td><p>Issue title/summary</p></td>
</tr>
<tr class="row-even"><td><p>description</p></td>
<td><p>TEXT</p></td>
<td><p>NOT NULL</p></td>
<td><p>Detailed issue description</p></td>
</tr>
<tr class="row-odd"><td><p>issue_type</p></td>
<td><p>ENUM</p></td>
<td><p>NOT NULL</p></td>
<td><p>Type of issue</p></td>
</tr>
<tr class="row-even"><td><p>priority</p></td>
<td><p>ENUM</p></td>
<td><p>DEFAULT ‘medium’</p></td>
<td><p>Issue priority level</p></td>
</tr>
<tr class="row-odd"><td><p>status</p></td>
<td><p>ENUM</p></td>
<td><p>DEFAULT ‘reported’</p></td>
<td><p>Current issue status</p></td>
</tr>
<tr class="row-even"><td><p>location</p></td>
<td><p>VARCHAR(200)</p></td>
<td><p>NOT NULL</p></td>
<td><p>Issue location</p></td>
</tr>
<tr class="row-odd"><td><p>user_id</p></td>
<td><p>INTEGER</p></td>
<td><p>FOREIGN KEY</p></td>
<td><p>Reporter user ID</p></td>
</tr>
<tr class="row-even"><td><p>facility_id</p></td>
<td><p>INTEGER</p></td>
<td><p>FOREIGN KEY, NULLABLE</p></td>
<td><p>Related facility ID</p></td>
</tr>
<tr class="row-odd"><td><p>assigned_to</p></td>
<td><p>INTEGER</p></td>
<td><p>FOREIGN KEY, NULLABLE</p></td>
<td><p>Assigned admin user ID</p></td>
</tr>
<tr class="row-even"><td><p>admin_notes</p></td>
<td><p>TEXT</p></td>
<td><p>NULLABLE</p></td>
<td><p>Administrative notes</p></td>
</tr>
<tr class="row-odd"><td><p>feedback_rating</p></td>
<td><p>INTEGER</p></td>
<td><p>NULLABLE</p></td>
<td><p>User feedback rating (1-5)</p></td>
</tr>
<tr class="row-even"><td><p>feedback_comment</p></td>
<td><p>TEXT</p></td>
<td><p>NULLABLE</p></td>
<td><p>User feedback comment</p></td>
</tr>
<tr class="row-odd"><td><p>created_at</p></td>
<td><p>DATETIME</p></td>
<td><p>DEFAULT CURRENT_TIMESTAMP</p></td>
<td><p>Issue creation time</p></td>
</tr>
<tr class="row-even"><td><p>updated_at</p></td>
<td><p>DATETIME</p></td>
<td><p>DEFAULT CURRENT_TIMESTAMP</p></td>
<td><p>Last update time</p></td>
</tr>
<tr class="row-odd"><td><p>resolved_at</p></td>
<td><p>DATETIME</p></td>
<td><p>NULLABLE</p></td>
<td><p>Resolution timestamp</p></td>
</tr>
</tbody>
</table>
<p><strong>Enums:</strong></p>
<ul class="simple">
<li><p><strong>issue_type</strong>: electrical, hygiene, structural, equipment, security, other</p></li>
<li><p><strong>priority</strong>: low, medium, high, urgent</p></li>
<li><p><strong>status</strong>: reported, in_progress, resolved, closed</p></li>
</ul>
<p><strong>Foreign Keys:</strong>
- user_id → users.id
- facility_id → facilities.id
- assigned_to → users.id</p>
<p><strong>Indexes:</strong>
- Index on user_id
- Index on facility_id
- Index on status
- Index on priority
- Index on created_at</p>
<p><strong>Example Record:</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">issues</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;Air conditioning not working&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;The air conditioning unit in Computer Lab 1 has been malfunctioning since yesterday. Room temperature is too high for comfortable use.&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;equipment&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;high&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;reported&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;Computer Lab 1, Block A Level 2&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;2025-01-20 14:30:00&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;2025-01-20 14:30:00&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="k">NULL</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
<section id="facility-bookings">
<h3><span class="section-number">1.3.4. </span>facility_bookings<a class="headerlink" href="#facility-bookings" title="Link to this heading"></a></h3>
<p>Manages facility booking requests and schedules.</p>
<table class="docutils align-default" id="id4">
<caption><span class="caption-text">facility_bookings Table Schema</span><a class="headerlink" href="#id4" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 15.0%" />
<col style="width: 45.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Constraints</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>INTEGER</p></td>
<td><p>PRIMARY KEY</p></td>
<td><p>Unique booking identifier</p></td>
</tr>
<tr class="row-odd"><td><p>facility_id</p></td>
<td><p>INTEGER</p></td>
<td><p>FOREIGN KEY, NOT NULL</p></td>
<td><p>Booked facility ID</p></td>
</tr>
<tr class="row-even"><td><p>user_id</p></td>
<td><p>INTEGER</p></td>
<td><p>FOREIGN KEY, NOT NULL</p></td>
<td><p>Booking user ID</p></td>
</tr>
<tr class="row-odd"><td><p>booking_date</p></td>
<td><p>DATE</p></td>
<td><p>NOT NULL</p></td>
<td><p>Booking date</p></td>
</tr>
<tr class="row-even"><td><p>start_hour</p></td>
<td><p>INTEGER</p></td>
<td><p>NOT NULL</p></td>
<td><p>Start hour (0-23)</p></td>
</tr>
<tr class="row-odd"><td><p>end_hour</p></td>
<td><p>INTEGER</p></td>
<td><p>NOT NULL</p></td>
<td><p>End hour (0-23)</p></td>
</tr>
<tr class="row-even"><td><p>purpose</p></td>
<td><p>VARCHAR(200)</p></td>
<td><p>NULLABLE</p></td>
<td><p>Booking purpose description</p></td>
</tr>
<tr class="row-odd"><td><p>status</p></td>
<td><p>ENUM</p></td>
<td><p>DEFAULT ‘pending’</p></td>
<td><p>Booking status</p></td>
</tr>
<tr class="row-even"><td><p>admin_notes</p></td>
<td><p>TEXT</p></td>
<td><p>NULLABLE</p></td>
<td><p>Administrative notes</p></td>
</tr>
<tr class="row-odd"><td><p>created_at</p></td>
<td><p>DATETIME</p></td>
<td><p>DEFAULT CURRENT_TIMESTAMP</p></td>
<td><p>Booking request time</p></td>
</tr>
<tr class="row-even"><td><p>updated_at</p></td>
<td><p>DATETIME</p></td>
<td><p>DEFAULT CURRENT_TIMESTAMP</p></td>
<td><p>Last update time</p></td>
</tr>
</tbody>
</table>
<p><strong>Enums:</strong>
- <strong>status</strong>: pending, approved, rejected, cancelled</p>
<p><strong>Foreign Keys:</strong>
- facility_id → facilities.id
- user_id → users.id</p>
<p><strong>Indexes:</strong>
- Index on facility_id
- Index on user_id
- Index on booking_date
- Index on status
- Composite index on (facility_id, booking_date)</p>
<p><strong>Constraints:</strong>
- end_hour must be greater than start_hour
- booking_date must be in the future
- No overlapping bookings for same facility</p>
<p><strong>Example Record:</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">facility_bookings</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;2025-01-25&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="mi">9</span><span class="p">,</span>
<span class="w">    </span><span class="mi">11</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;Software development workshop for final year students&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;pending&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;2025-01-20 10:15:00&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;2025-01-20 10:15:00&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
<section id="chat-sessions">
<h3><span class="section-number">1.3.5. </span>chat_sessions<a class="headerlink" href="#chat-sessions" title="Link to this heading"></a></h3>
<p>Manages chatbot conversation sessions.</p>
<table class="docutils align-default" id="id5">
<caption><span class="caption-text">chat_sessions Table Schema</span><a class="headerlink" href="#id5" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 15.0%" />
<col style="width: 45.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Constraints</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>INTEGER</p></td>
<td><p>PRIMARY KEY</p></td>
<td><p>Unique session identifier</p></td>
</tr>
<tr class="row-odd"><td><p>user_id</p></td>
<td><p>INTEGER</p></td>
<td><p>FOREIGN KEY, NOT NULL</p></td>
<td><p>Session user ID</p></td>
</tr>
<tr class="row-even"><td><p>session_id</p></td>
<td><p>VARCHAR(50)</p></td>
<td><p>NOT NULL</p></td>
<td><p>Session UUID</p></td>
</tr>
<tr class="row-odd"><td><p>created_at</p></td>
<td><p>DATETIME</p></td>
<td><p>DEFAULT CURRENT_TIMESTAMP</p></td>
<td><p>Session start time</p></td>
</tr>
</tbody>
</table>
<p><strong>Foreign Keys:</strong>
- user_id → users.id</p>
<p><strong>Indexes:</strong>
- Index on user_id
- Index on session_id
- Index on created_at</p>
</section>
<section id="chat-messages">
<h3><span class="section-number">1.3.6. </span>chat_messages<a class="headerlink" href="#chat-messages" title="Link to this heading"></a></h3>
<p>Stores individual messages within chat sessions.</p>
<table class="docutils align-default" id="id6">
<caption><span class="caption-text">chat_messages Table Schema</span><a class="headerlink" href="#id6" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 15.0%" />
<col style="width: 45.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Constraints</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>INTEGER</p></td>
<td><p>PRIMARY KEY</p></td>
<td><p>Unique message identifier</p></td>
</tr>
<tr class="row-odd"><td><p>session_id</p></td>
<td><p>INTEGER</p></td>
<td><p>FOREIGN KEY, NOT NULL</p></td>
<td><p>Chat session ID</p></td>
</tr>
<tr class="row-even"><td><p>message</p></td>
<td><p>TEXT</p></td>
<td><p>NOT NULL</p></td>
<td><p>Message content</p></td>
</tr>
<tr class="row-odd"><td><p>is_user</p></td>
<td><p>BOOLEAN</p></td>
<td><p>NOT NULL</p></td>
<td><p>True if user message, false if bot</p></td>
</tr>
<tr class="row-even"><td><p>intent</p></td>
<td><p>VARCHAR(50)</p></td>
<td><p>NULLABLE</p></td>
<td><p>Detected user intent</p></td>
</tr>
<tr class="row-odd"><td><p>entities</p></td>
<td><p>JSON</p></td>
<td><p>NULLABLE</p></td>
<td><p>Extracted entities</p></td>
</tr>
<tr class="row-even"><td><p>timestamp</p></td>
<td><p>DATETIME</p></td>
<td><p>DEFAULT CURRENT_TIMESTAMP</p></td>
<td><p>Message timestamp</p></td>
</tr>
</tbody>
</table>
<p><strong>Foreign Keys:</strong>
- session_id → chat_sessions.id</p>
<p><strong>Indexes:</strong>
- Index on session_id
- Index on timestamp
- Index on is_user</p>
</section>
</section>
<section id="database-operations">
<h2><span class="section-number">1.4. </span>Database Operations<a class="headerlink" href="#database-operations" title="Link to this heading"></a></h2>
<section id="common-queries">
<h3><span class="section-number">1.4.1. </span>Common Queries<a class="headerlink" href="#common-queries" title="Link to this heading"></a></h3>
<p><strong>User Management:</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Find all admin users</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">full_name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="p">;</span>

<span class="c1">-- Count users by role</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">role</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">role</span><span class="p">;</span>

<span class="c1">-- Find users registered in last 7 days</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">datetime</span><span class="p">(</span><span class="s1">&#39;now&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-7 days&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Issue Management:</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Find all open issues</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">full_name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">reporter</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">priority</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">status</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">issues</span><span class="w"> </span><span class="n">i</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">status</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;reported&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;in_progress&#39;</span><span class="p">);</span>

<span class="c1">-- Count issues by status</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">issues</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>

<span class="c1">-- Find high priority unassigned issues</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">priority</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">issues</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">assigned_to</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Facility Management:</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- List all bookable facilities</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">category</span><span class="p">,</span><span class="w"> </span><span class="k">location</span><span class="p">,</span><span class="w"> </span><span class="n">capacity</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">facilities</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">is_bookable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span><span class="p">;</span>

<span class="c1">-- Find facility utilization</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">fb</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">booking_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">facilities</span><span class="w"> </span><span class="n">f</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">facility_bookings</span><span class="w"> </span><span class="n">fb</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="n">facility_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;approved&#39;</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">name</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">booking_count</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Booking Management:</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Find pending bookings</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">full_name</span><span class="p">,</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="n">booking_date</span><span class="p">,</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="n">start_hour</span><span class="p">,</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="n">end_hour</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">facility_bookings</span><span class="w"> </span><span class="n">fb</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">facilities</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="n">facility_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">id</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;pending&#39;</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="n">booking_date</span><span class="p">,</span><span class="w"> </span><span class="n">fb</span><span class="p">.</span><span class="n">start_hour</span><span class="p">;</span>

<span class="c1">-- Check for booking conflicts</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">fb1</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">fb2</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">fb1</span><span class="p">.</span><span class="n">booking_date</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">facility_bookings</span><span class="w"> </span><span class="n">fb1</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">facility_bookings</span><span class="w"> </span><span class="n">fb2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">fb1</span><span class="p">.</span><span class="n">facility_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fb2</span><span class="p">.</span><span class="n">facility_id</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">facilities</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">fb1</span><span class="p">.</span><span class="n">facility_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">fb1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">fb2</span><span class="p">.</span><span class="n">id</span>
<span class="k">AND</span><span class="w"> </span><span class="n">fb1</span><span class="p">.</span><span class="n">booking_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fb2</span><span class="p">.</span><span class="n">booking_date</span>
<span class="k">AND</span><span class="w"> </span><span class="n">fb1</span><span class="p">.</span><span class="n">start_hour</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">fb2</span><span class="p">.</span><span class="n">end_hour</span>
<span class="k">AND</span><span class="w"> </span><span class="n">fb1</span><span class="p">.</span><span class="n">end_hour</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">fb2</span><span class="p">.</span><span class="n">start_hour</span>
<span class="k">AND</span><span class="w"> </span><span class="n">fb1</span><span class="p">.</span><span class="n">status</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;approved&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pending&#39;</span><span class="p">)</span>
<span class="k">AND</span><span class="w"> </span><span class="n">fb2</span><span class="p">.</span><span class="n">status</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;approved&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pending&#39;</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="database-maintenance">
<h2><span class="section-number">1.5. </span>Database Maintenance<a class="headerlink" href="#database-maintenance" title="Link to this heading"></a></h2>
<section id="regular-maintenance-tasks">
<h3><span class="section-number">1.5.1. </span>Regular Maintenance Tasks<a class="headerlink" href="#regular-maintenance-tasks" title="Link to this heading"></a></h3>
<p><strong>Daily Tasks:</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Clean up old chat sessions (older than 30 days)</span>
<span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">chat_messages</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">session_id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">chat_sessions</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">datetime</span><span class="p">(</span><span class="s1">&#39;now&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-30 days&#39;</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">chat_sessions</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">datetime</span><span class="p">(</span><span class="s1">&#39;now&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-30 days&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Weekly Tasks:</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Vacuum database to reclaim space</span>
<span class="k">VACUUM</span><span class="p">;</span>

<span class="c1">-- Analyze tables for query optimization</span>
<span class="k">ANALYZE</span><span class="p">;</span>

<span class="c1">-- Check database integrity</span>
<span class="n">PRAGMA</span><span class="w"> </span><span class="n">integrity_check</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Monthly Tasks:</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Archive old resolved issues (optional)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">issues_archive</span><span class="w"> </span><span class="k">AS</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">issues</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">-- Create structure only</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">issues_archive</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">issues</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;closed&#39;</span>
<span class="k">AND</span><span class="w"> </span><span class="n">resolved_at</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">datetime</span><span class="p">(</span><span class="s1">&#39;now&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-90 days&#39;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="backup-and-recovery">
<h3><span class="section-number">1.5.2. </span>Backup and Recovery<a class="headerlink" href="#backup-and-recovery" title="Link to this heading"></a></h3>
<p><strong>Database Backup:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create database backup</span>
cp<span class="w"> </span>instance/utm_campus.db<span class="w"> </span>backups/utm_campus_<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span>.db

<span class="c1"># Create SQL dump</span>
sqlite3<span class="w"> </span>instance/utm_campus.db<span class="w"> </span>.dump<span class="w"> </span>&gt;<span class="w"> </span>backups/utm_campus_<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>.sql
</pre></div>
</div>
<p><strong>Database Recovery:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Restore from backup file</span>
cp<span class="w"> </span>backups/utm_campus_YYYYMMDD_HHMMSS.db<span class="w"> </span>instance/utm_campus.db

<span class="c1"># Restore from SQL dump</span>
sqlite3<span class="w"> </span>instance/utm_campus_new.db<span class="w"> </span>&lt;<span class="w"> </span>backups/utm_campus_YYYYMMDD.sql
</pre></div>
</div>
</section>
</section>
<section id="performance-optimization">
<h2><span class="section-number">1.6. </span>Performance Optimization<a class="headerlink" href="#performance-optimization" title="Link to this heading"></a></h2>
<section id="index-optimization">
<h3><span class="section-number">1.6.1. </span>Index Optimization<a class="headerlink" href="#index-optimization" title="Link to this heading"></a></h3>
<p>Current indexes provide efficient querying for:</p>
<ul class="simple">
<li><p>User lookups by username/email</p></li>
<li><p>Issue filtering by status/priority</p></li>
<li><p>Facility searches by category</p></li>
<li><p>Booking conflicts detection</p></li>
<li><p>Chat session retrieval</p></li>
</ul>
<p><strong>Monitor Query Performance:</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Enable query plan output</span>
<span class="p">.</span><span class="n">eqp</span><span class="w"> </span><span class="k">on</span>

<span class="c1">-- Analyze slow queries</span>
<span class="k">EXPLAIN</span><span class="w"> </span><span class="n">QUERY</span><span class="w"> </span><span class="n">PLAN</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">issues</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;reported&#39;</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="database-size-management">
<h3><span class="section-number">1.6.2. </span>Database Size Management<a class="headerlink" href="#database-size-management" title="Link to this heading"></a></h3>
<p><strong>Monitor Database Size:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check database file size</span>
du<span class="w"> </span>-h<span class="w"> </span>instance/utm_campus.db

<span class="c1"># Check table sizes</span>
sqlite3<span class="w"> </span>instance/utm_campus.db<span class="w"> </span><span class="s2">&quot;</span>
<span class="s2">SELECT name,</span>
<span class="s2">       COUNT(*) as row_count</span>
<span class="s2">FROM sqlite_master m</span>
<span class="s2">JOIN pragma_table_info(m.name) p</span>
<span class="s2">WHERE m.type = &#39;table&#39;</span>
<span class="s2">GROUP BY name;&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="migration-scripts">
<h2><span class="section-number">1.7. </span>Migration Scripts<a class="headerlink" href="#migration-scripts" title="Link to this heading"></a></h2>
<section id="schema-updates">
<h3><span class="section-number">1.7.1. </span>Schema Updates<a class="headerlink" href="#schema-updates" title="Link to this heading"></a></h3>
<p>When updating the database schema, use migration scripts:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example migration script</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">app</span><span class="w"> </span><span class="kn">import</span> <span class="n">app</span><span class="p">,</span> <span class="n">db</span>

<span class="k">def</span><span class="w"> </span><span class="nf">migrate_add_column</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
        <span class="c1"># Add new column to existing table</span>
        <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;ALTER TABLE users ADD COLUMN last_login DATETIME&#39;</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Migration completed: Added last_login column&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="data-migration">
<h3><span class="section-number">1.7.2. </span>Data Migration<a class="headerlink" href="#data-migration" title="Link to this heading"></a></h3>
<p>For data transformations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">migrate_facility_categories</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
        <span class="c1"># Update old category names to new standard</span>
        <span class="n">facilities</span> <span class="o">=</span> <span class="n">Facility</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="s1">&#39;Lab&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">facility</span> <span class="ow">in</span> <span class="n">facilities</span><span class="p">:</span>
            <span class="n">facility</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="s1">&#39;Laboratory&#39;</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Updated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">facilities</span><span class="p">)</span><span class="si">}</span><span class="s1"> facility categories&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="security-considerations">
<h2><span class="section-number">1.8. </span>Security Considerations<a class="headerlink" href="#security-considerations" title="Link to this heading"></a></h2>
<section id="data-protection">
<h3><span class="section-number">1.8.1. </span>Data Protection<a class="headerlink" href="#data-protection" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Password Hashing</strong>: All passwords stored using bcrypt</p></li>
<li><p><strong>Input Validation</strong>: All user inputs validated and sanitized</p></li>
<li><p><strong>SQL Injection Prevention</strong>: Using SQLAlchemy ORM with parameterized queries</p></li>
<li><p><strong>Session Security</strong>: Secure session cookies with proper configuration</p></li>
</ul>
</section>
<section id="access-control">
<h3><span class="section-number">1.8.2. </span>Access Control<a class="headerlink" href="#access-control" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Role-Based Access</strong>: Users can only access appropriate data</p></li>
<li><p><strong>Data Isolation</strong>: Users can only see their own issues and bookings</p></li>
<li><p><strong>Admin Auditing</strong>: All admin actions should be logged</p></li>
</ul>
</section>
<section id="backup-security">
<h3><span class="section-number">1.8.3. </span>Backup Security<a class="headerlink" href="#backup-security" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Encrypted Backups</strong>: Consider encrypting database backups</p></li>
<li><p><strong>Secure Storage</strong>: Store backups in secure, access-controlled locations</p></li>
<li><p><strong>Regular Testing</strong>: Regularly test backup restoration procedures</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../api-reference/index.html" class="btn btn-neutral float-left" title="&lt;no title&gt;" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../configuration-reference/index.html" class="btn btn-neutral float-right" title="&lt;no title&gt;" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, UTM IT Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>